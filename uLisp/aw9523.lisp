(defvar AW9523-ADDR #x58)
(defvar AW9523-LED-P1_0-DIM #x20)
(defvar AW9523-LED-P1_1-DIM #x21)
(defvar AW9523-LED-P1_2-DIM #x22)
(defvar AW9523-LED-P1_3-DIM #x23)
(defvar AW9523-LED-P0_0-DIM #x24)
(defvar AW9523-LED-P0_1-DIM #x25)
(defvar AW9523-LED-P0_2-DIM #x26)
(defvar AW9523-LED-P0_3-DIM #x27)
(defvar AW9523-LED-P0_4-DIM #x28)
(defvar AW9523-LED-P0_5-DIM #x29)
(defvar AW9523-LED-P0_6-DIM #x2a)
(defvar AW9523-LED-P0_7-DIM #x2b)
(defvar AW9523-LED-P1_4-DIM #x2c)
(defvar AW9523-LED-P1_5-DIM #x2d)
(defvar AW9523-LED-P1_6-DIM #x2e)
(defvar AW9523-LED-P1_7-DIM #x2f)

(defun aw9523-set-led-mode ()
    (with-i2c (str AW9523-ADDR)
        (write-byte #x12 str)
        (write-byte #x00 str)
        (restart-i2c str)
        (write-byte #x13 str)
        (write-byte #x00 str)))

(defun aw9523-set-current-limit ()
    (with-i2c (str AW9523-ADDR)
        (write-byte #x11 str)
        (write-byte #x03 str)))

(defun aw9523-set-led-current (port current)
    (with-i2c (str AW9523-ADDR)
        (write-byte port str)
        (write-byte current str)))

(defun blink ()
    (aw9523-set-led-mode)
    (aw9523-set-current-limit)
    (loop
        (for-millis (500)
            (aw9523-set-led-current AW9523-LED-P0_1-DIM #x20))
        (for-millis (500)
            (aw9523-set-led-current AW9523-LED-P0_1-DIM #x00))))
